

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
 
  <link rel="stylesheet" href=" styles/login.css">
  <title>Log In </title>
</head>
<body>
  <main>
  <div class="appContainer">
    <div class="leftBox appLeftBox">
      <div class="logo">
      <img src="assets/icons/doublehelix.svg">
      <span>Optimize your body,hack your life</span>
            </div>
    </div>
      
   
        <div class="rightBox appRightBox" >
          <!-- <div class="SignupAndLogin">
              <a href="exit.html">Log In</a>
              <a href="register.html">Register</a>
          </div> -->
          <!-- Register Box  -->
 <div class="loginBox " id="registerBox">
  <!-- //attach register.php to traverse to another page when clicked  -->

          <form method="POST" action="" novalidate>
          
         

            <a href="appLogin.html" id="backToLogin">&lt; Log In</a>
            <h2>Register</h2>
         <!-- <div> -->
      
    <!-- <div class="error"></div> -->
    <!-- </div> -->

            <label><input type="email" id = "email" name ="email" placeholder="Email Address" required /></label> 
         
         
          <!-- <label for=""></label> -->

       

       <!-- <div class="error"></div> -->
     


            <div class="password">
              <!-- <input type="password" id="newPassword" name="newPassword" placeholder="New Password" required /> -->
                <!-- <label for=""></label> -->
              

  <!-- To send request.GET.next to POST for redirection to the correct page  -->
  <!-- Using request.Get.Next as a fallback in case request.Post.Next fails    -->
   <!-- <input type = "hidden" name ="next" value = {{request.Get.next}}/>

              <
              commenting html tags and embedding django templates
 -->            <!--   <div class="eyeBackground">
                <div class="eyeIconCard" id="toggleNewPassword">
                  <img src="" alt="Show Password" />
                </div>
              </div> -->
              
            </div>
            <!-- <div class="error"></div> -->


            <!-- <div class="password"> -->
              <!-- <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm Password" required /> -->
<!--   <label for=""></label>
              
              <div class="eyeBackground">
                <div class="eyeIconCard" id="toggleConfirmPassword">
                  <img src="" alt="Show Password" />
                </div>
              
            </div>
            </div> -->
               <!-- <div class="error"></div> -->
            <!-- making sure that if Phone number is empty then to return default empty  -->

  <!-- <input type = "hidden" name ="next" value = ""> -->

            <label><input type="number" id ="showCode" placeholder="Numbers" /></label>
            <button type="submit" id = "login">Next</button>
          </form>
        </div>
        </div>

  </div>
  </main>

</body>

<div class="toast fail"></div>
<div class="toast success"></div>
<script>
  // const passwordInput = document.getElementById("passwordInput");
  // const togglePassword = document.getElementById("togglePassword");
  // const eyeIcon = togglePassword.querySelector("img");
  // togglePassword.style.transition = "opacity 0.4s ease";
  // togglePassword.addEventListener("click",()=>
  // {
  //  const isHidden = passwordInput.type ==="password";
  //  passwordInput.type =isHidden ?"text":"password";
  //  eyeIcon.src = isHidden ? "assets/icons/Eye-closed.svg":"assets/icons/Eye-open.svg";
     
  //  if(isHidden)
  //  {
  //   eyeIcon.src = "assets/icons/Eye-closed.svg";
  //                togglePassword.style.opacity = 0.5;
  //  }

  //  else 
  //  {eyeIcon.src ="assets/icons/Eye-open.svg";
  //                 togglePassword.style.opacity = 1;
  // }});




  // function setUpToggle(inputId,toggleId)
  // {
  //    const input = document.getElementsByName(inputId)[0];
  //   console.log(input)
  //   // const toggle  = document.getElementById(toggleId);
  //   // const icon = toggle.querySelector("img");
  //   const showCode = document.getElementById("showCode")




  //   toggle.addEventListener("click",()=>
  //   {
  //     const isHidden = input.type === "password";
  //     console.log(input.type)
  //     input.type = isHidden?"text":"password";
  //     icon.src =isHidden?"" : "";
  //   })
  // }
// document.querySelector("#registerBox form").addEventListener("submit", (e) => {
//     const newPassword = document.getElementsByName("password1")[0].value;
//     const confirmPassword = document.getElementsByName("password2")[0].value;
 
//     if (newPassword !== confirmPassword) {
//         e.preventDefault();  
//         showToast("Passwords do not match!");
//         return;
//     }
// });
 const loginButton = document.getElementById("login");
 const emailInput = document.getElementById("email")
let codeNumbers =  document.getElementById("showCode")
codeNumbers.style.display = "none"
document.querySelector("#registerBox form").addEventListener("submit",async(e)=>
{

e.preventDefault();
if(loginButton.innerText == "Next")
{

try {
  const data = await fetch("http://127.0.0.1:8000/app/request_email_otp/",{
    method : "POST",
    body : JSON.stringify({email:emailInput.value}),
    headers: {
  "Content-Type": "application/json"
},
    credentials:"include"
  })
 const res = await data.json();
 if (res.success)
 {
  showToast("The code has successfully been sent to your email")
codeNumbers.style.display = "block"
loginButton.innerText = "Login"
 }
 else
 {
  showToast(res.error)
 }

}
catch(e)
{
  console.log(e)
}
}
else {
try{
  const data = await fetch("http://127.0.0.1:8000/app/verify_email_otp/",
  {
    method:"POST",
    headers :{"Content-Type":"application/json"},
    body:JSON.stringify({email : emailInput.value,otp : codeNumbers.value}),
    credentials:"include"
  })
  const res = await data.json()
  if(res.success)
  {
sessionStorage.setItem("justLoggedIn","1") 
    window.location.href = "mainApp.html"
  
  }else 
  showToast(res.error)
}
catch (e)
{
console.log(e)
}
}})
  // setUpToggle("password1","toggleNewPassword");
  // setUpToggle("password2","toggleConfirmPassword");

const loginBox = document.getElementById("loginBox");
const registerBox = document.getElementById("registerBox");
// const showRegister = document.getElementById("showRegister");
const backToLogin = document.getElementById("backToLogin");

// showRegister.addEventListener("click" ,(e)=>
// {
//  e.preventDefault();
//  // loginBox.classList.add("hiddenBox");
//  // registerBox.classList.remove("hiddenBox");
// });
// backToLogin.addEventListener("click",(e)=>{
// e.preventDefault();
// // loginBox.classList.remove("hiddenBox");

// });

function showToast(message) {
  let toast;
  if(message.toLowerCase().includes("successfully"))
  toast = document.querySelector(".toast.success");
  else
  toast = document.querySelector(".toast.fail");
  
  toast.textContent = message;
  toast.classList.add("show");

  // Hide after 3s
  setTimeout(() => {
    toast.classList.remove("show");
    if("{{show_toast}}" == "Successfully Logged out")
    window.location.href = "/login/"

  }, 1500);
}
// <?php
//  if(!empty($message)):
// ?>
// showToast("<?= htmlspecialchars($message)?>");
// currentURL = window.location.href;
// if(currentURL)
// {
// console.log(currentURL);
//  if( currentURL.toLowerCase().includes("/logout/")){
//     showToast("Successfully logged out");
//  }

  
// }

// {% if show_toast == "Successfully Logged out"  %}
// showToast("{{show_toast}}");
// {% elif show_toast == "Invalid username or password" %}
// showToast("{{show_toast}}");
// {% elif show_toast == "Already Registered" %}
// showToast("{{show_toast}}")
// {% elif show_toast == "Fill up the fields correctly" %}
// showToast("{{show_toast}}")    
// {% elif show_toast == "Already Registered" %}
// showToast("{{show_toast}}") 

// {% endif %}


// <?php endif?>
// //each time you click on back button it should be refreshed
// window.onpageshow = function(e) {
//   if (e.persisted) location.reload();
// };
//   // âœ… Remove the `msg` parameter from the URL

//   history.replaceState(null, '', window.location.pathname);


</script>


</html>